<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AirBot - نظام إدارة التذاكر الفنية</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="./styles/conact.css">
    <link rel="icon" href="./images/icon.png" type="image/png">
  <style>

  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header text-center">
      <h1 class="mb-3"><i class="fas fa-robot me-2"></i>نظام إدارة التذاكر الفنية - AirBot</h1>
      <p class="lead mb-0">أدخل تفاصيل مشكلتك وسيقوم فريق الدعم الفني بالرد عليك في أقرب وقت</p>
    </div>
    
    <!-- Statistics -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="stat-card stat-high">
          <i class="fas fa-exclamation-triangle fa-2x"></i>
          <div class="stat-number" id="highCount">0</div>
          <div>تذاكر عاجلة</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card stat-medium">
          <i class="fas fa-exclamation-circle fa-2x"></i>
          <div class="stat-number" id="mediumCount">0</div>
          <div>تذاكر متوسطة</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card stat-low">
          <i class="fas fa-check-circle fa-2x"></i>
          <div class="stat-number" id="lowCount">0</div>
          <div>تذاكر بسيطة</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card stat-resolved">
          <i class="fas fa-clipboard-check fa-2x"></i>
          <div class="stat-number" id="resolvedCount">0</div>
          <div>تم حلها</div>
        </div>
      </div>
    </div>
    
    <div class="row">
      <!-- Form Section -->
      <div class="col-lg-5">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <i class="fas fa-ticket-alt me-2"></i>فتح تذكرة دعم فني جديدة
          </div>
          <div class="card-body">
            <form id="ticketForm">
              <div class="mb-3">
                <label for="title" class="form-label">عنوان المشكلة</label>
                <input type="text" class="form-control" id="title" placeholder="أدخل عنواناً واضحاً للمشكلة" required>
              </div>
              
              <div class="mb-3">
                <label for="issue" class="form-label">وصف المشكلة</label>
                <textarea class="form-control" id="issue" rows="4" placeholder="صف مشكلتك بالتفصيل..." required></textarea>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="category" class="form-label">نوع المشكلة</label>
                  <select class="form-select" id="category" required>
                    <option value="">اختر النوع...</option>
                    <option value="technical">مشكلة فنية</option>
                    <option value="account">مشكلة في الحساب</option>
                    <option value="payment">مشكلة في الدفع</option>
                    <option value="feature">طلب ميزة جديدة</option>
                    <option value="other">أخرى</option>
                  </select>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="impact" class="form-label">مدى التأثير</label>
                  <select class="form-select" id="impact" required>
                    <option value="">اختر التأثير...</option>
                    <option value="High">عاجلة (High) - توقف كامل للنظام</option>
                    <option value="Medium">متوسطة (Medium) - تأثير على بعض الوظائف</option>
                    <option value="Low">بسيطة (Low) - مشكلة ثانوية</option>
                  </select>
                </div>
              </div>
              
              <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-paper-plane me-2"></i>إرسال التذكرة
                </button>
              </div>
            </form>
          </div>
        </div>
        
        <div class="text-center mt-4 mb-4">
          <a href="./index.html" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i>الرجوع للقائمة الرئيسية
          </a>
        </div>
      </div>
      
      <!-- Tickets List -->
      <div class="col-lg-7">
        <div class="card">
          <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
            <span><i class="fas fa-tasks me-2"></i>التذاكر المفتوحة</span>
            <div>
              <button class="btn btn-sm btn-light" id="refreshTickets">
                <i class="fas fa-sync-alt me-1"></i> تحديث
              </button>
              <button class="btn btn-sm btn-danger ms-2" id="deleteAllBtn">
                <i class="fas fa-trash-alt me-1"></i> مسح الكل
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <ul class="list-group list-group-flush" id="ticketsList">
              <!-- Tickets will be loaded here dynamically -->
            </ul>
            
            <div class="empty-state d-none" id="emptyState">
              <i class="fas fa-inbox"></i>
              <h5>لا توجد تذاكر مفتوحة</h5>
              <p>لم تقم بفتح أي تذاكر حتى الآن. ابدأ بفتح تذكرة جديدة باستخدام النموذج.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Generate unique ID for tickets
    function generateTicketId() {
      return 'TKT-' + Math.floor(100000 + Math.random() * 900000);
    }
    
    // Get current date in arabic format
    function getCurrentDate() {
      const now = new Date();
      return now.toLocaleString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    // Save ticket to localStorage
    function saveTicket(ticket) {
      const tickets = JSON.parse(localStorage.getItem('supportTickets')) || [];
      tickets.unshift(ticket); // Add new ticket at the beginning
      localStorage.setItem('supportTickets', JSON.stringify(tickets));
      return tickets;
    }
    
    // Load tickets from localStorage
    function loadTickets() {
      return JSON.parse(localStorage.getItem('supportTickets')) || [];
    }
    
    // Render tickets list
    function renderTickets() {
      const tickets = loadTickets();
      const ticketsList = document.getElementById('ticketsList');
      const emptyState = document.getElementById('emptyState');
      
      // Update statistics
      const highCount = tickets.filter(t => t.impact === 'High' && t.status !== 'resolved').length;
      const mediumCount = tickets.filter(t => t.impact === 'Medium' && t.status !== 'resolved').length;
      const lowCount = tickets.filter(t => t.impact === 'Low' && t.status !== 'resolved').length;
      const resolvedCount = tickets.filter(t => t.status === 'resolved').length;
      
      document.getElementById('highCount').textContent = highCount;
      document.getElementById('mediumCount').textContent = mediumCount;
      document.getElementById('lowCount').textContent = lowCount;
      document.getElementById('resolvedCount').textContent = resolvedCount;
      
      // Clear current list
      ticketsList.innerHTML = '';
      
      if (tickets.length === 0) {
        emptyState.classList.remove('d-none');
        return;
      }
      
      emptyState.classList.add('d-none');
      
      // Render each ticket
      tickets.forEach(ticket => {
        const impactClass = `impact-${ticket.impact.toLowerCase()}`;
        const badgeClass = `badge-${ticket.impact.toLowerCase()}`;
        const statusClass = `status-${ticket.status === 'resolved' ? 'resolved' : 'new'}`;
        const resolvedClass = ticket.status === 'resolved' ? 'resolved-ticket' : '';
        
        const li = document.createElement('li');
        li.className = `list-group-item ticket-item ${impactClass} ${resolvedClass}`;
        li.innerHTML = `
          <button class="delete-btn" data-id="${ticket.id}">
            <i class="fas fa-trash"></i>
          </button>
          <div class="d-flex justify-content-between align-items-start">
            <div class="ticket-info flex-grow-1">
              <h5 class="mb-1">${ticket.title}</h5>
              <p class="mb-1 text-muted">${ticket.issue.substring(0, 70)}${ticket.issue.length > 70 ? '...' : ''}</p>
              <div class="d-flex mt-2">
                <span class="badge ${badgeClass} badge-impact me-2">${ticket.impact}</span>
                <span class="ticket-status ${statusClass}">${ticket.status === 'resolved' ? 'تم الحل' : 'جديدة'}</span>
              </div>
            </div>
            <div class="ticket-meta text-end">
              <div class="ticket-id">${ticket.id}</div>
              <div class="text-muted small">${ticket.date}</div>
            </div>
          </div>
          <div class="ticket-details d-none">
            <p><strong>التفاصيل:</strong> ${ticket.issue}</p>
            <p><strong>النوع:</strong> ${ticket.category}</p>
            <div class="action-buttons">
              <button class="btn btn-sm btn-danger delete-ticket" data-id="${ticket.id}">
                <i class="fas fa-trash me-1"></i>حذف التذكرة
              </button>
              ${ticket.status !== 'resolved' ? `
                <button class="btn btn-sm btn-resolve resolve-ticket" data-id="${ticket.id}">
                  <i class="fas fa-check-circle me-1"></i>تم الحل
                </button>
              ` : ''}
            </div>
          </div>
        `;
        
        ticketsList.appendChild(li);
        
        // Add click event to show/hide details
        li.querySelector('.ticket-info').addEventListener('click', function() {
          const details = li.querySelector('.ticket-details');
          details.classList.toggle('d-none');
        });
      });
      
      // Add delete functionality (top delete button)
      document.querySelectorAll('.delete-btn').forEach(button => {
        button.addEventListener('click', function(e) {
          e.stopPropagation();
          const ticketId = this.getAttribute('data-id');
          deleteTicket(ticketId);
        });
      });
      
      // Add delete functionality (inside details)
      document.querySelectorAll('.delete-ticket').forEach(button => {
        button.addEventListener('click', function(e) {
          e.stopPropagation();
          const ticketId = this.getAttribute('data-id');
          deleteTicket(ticketId);
        });
      });
      
      // Add resolve functionality
      document.querySelectorAll('.resolve-ticket').forEach(button => {
        button.addEventListener('click', function(e) {
          e.stopPropagation();
          const ticketId = this.getAttribute('data-id');
          resolveTicket(ticketId);
        });
      });
    }
    
    // Delete a ticket
    function deleteTicket(ticketId) {
      const tickets = loadTickets();
      const filteredTickets = tickets.filter(ticket => ticket.id !== ticketId);
      localStorage.setItem('supportTickets', JSON.stringify(filteredTickets));
      renderTickets();
    }
    
    // Delete all tickets
    function deleteAllTickets() {
      if (confirm('هل أنت متأكد من رغبتك في حذف جميع التذاكر؟')) {
        localStorage.removeItem('supportTickets');
        renderTickets();
      }
    }
    
    // Resolve a ticket
    function resolveTicket(ticketId) {
      const tickets = loadTickets();
      const updatedTickets = tickets.map(ticket => {
        if (ticket.id === ticketId) {
          return { ...ticket, status: 'resolved' };
        }
        return ticket;
      });
      
      localStorage.setItem('supportTickets', JSON.stringify(updatedTickets));
      renderTickets();
    }
    
    // Form submission handler
    document.getElementById('ticketForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const title = document.getElementById('title').value.trim();
      const issue = document.getElementById('issue').value.trim();
      const category = document.getElementById('category').value;
      const impact = document.getElementById('impact').value;
      
      if (title && issue && category && impact) {
        const ticket = {
          id: generateTicketId(),
          title,
          issue,
          category,
          impact,
          date: getCurrentDate(),
          status: 'new'
        };
        
        saveTicket(ticket);
        this.reset();
        renderTickets();
      }
    });
    
    // Refresh tickets button
    document.getElementById('refreshTickets').addEventListener('click', function() {
      renderTickets();
    });
    
    // Delete all tickets button
    document.getElementById('deleteAllBtn').addEventListener('click', function() {
      deleteAllTickets();
    });
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      renderTickets();
      
      // Add sample tickets for demo
      if (loadTickets().length === 0) {
        const sampleTickets = [
          {
            id: generateTicketId(),
            title: "لا يمكن تسجيل الدخول إلى النظام",
            issue: "عند محاولة تسجيل الدخول باستخدام بياناتي الصحيحة، أحصل على رسالة خطأ تفيد بأن كلمة المرور غير صحيحة.",
            category: "account",
            impact: "High",
            date: getCurrentDate(),
            status: "new"
          },
          {
            id: generateTicketId(),
            title: "مشكلة في معالجة الدفع",
            issue: "عند محاولة إتمام عملية دفع، تظهر رسالة خطأ تفيد بأن عملية الدفع لم تكتمل.",
            category: "payment",
            impact: "Medium",
            date: getCurrentDate(),
            status: "resolved"
          }
        ];
        
        localStorage.setItem('supportTickets', JSON.stringify(sampleTickets));
        renderTickets();
      }
    });
  </script>
</body>
</html>